{% extends 'base.html.twig' %}

{% block title %}{{ trick.title }}{% endblock %}

{% block body %}

    <div class="card trick">
        <div class="card-header">
            <h1>{{ trick.title }}</h1>
        </div>
        <img src="../img/{{ trick.img }}" class="card-img-top" alt="{{ trick.title }}">
        <div class="card-body">
            <p class="text-right"><i class="far fa-clock"></i> Publié le: {{ trick.createdAt | date("d/m/Y") }}</p>
            <p class="text-left">Type de figure : <a href="{{ path('typeTricks', {type: trick.type}) }}">{{ trick.type }}</a></p>
            <p>
                <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                    Voir les vidéos
                </button>
                <div class="collapse" id="collapseExample">
                    <div class="card card-body video">
                        <iframe src="{{ trick.video }}"
                                frameborder="0" allow=" encrypted-media" allowfullscreen=""></iframe>
                    </div>
                </div>
            </p>
            <h2>Description :</h2>
            <p class="card-text text-justify">{{ trick.content }}</p>
        </div>
    </div>

    <h3>Commentaires :</h3>

    {% if not app.user %}
    <h4 class="text-center">Pour laisser un commentaire,
        <a href="{{ path('registration') }}" class="ml btn btn-dark">Inscrivez-vous</a>
        ou
        <a href="{{ path('connection') }}" class="ml btn btn-dark">Connectez-vous</a>
    </h4>
    {% else %}
    <form class="form" method="post" action="{{ path('createComment',{'id' : trick.id}) }}">

        <div class="input-group flex-nowrap">
            <div class="input-group-prepend">
                <label for="comment" class="input-group-text" id="addon-wrapping">Ecrire un commentaire</label>
            </div>
            <textarea id="content" class="form-control" aria-label="content" name="content"
                      aria-describedby="addon-wrapping" rows="4" cols="20" required></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Envoyer</button>

    </form>

    {% endif %}

    {% for comment in trick.comments | sort((a, b) => b.createdAt <=> a.createdAt) %}

    <section class="card comment">
        <div class="flex-sb">
            <h4 class="card-header">Posté par : <strong>{{ comment.user.username }}</strong>,
                le {{ comment.createdAt | date("d/m/Y à g:i") }}
            </h4>
        </div>
        <div class="card-body d-flex justify-content-between">
            <p class="card-text">{{ comment.content }}</p>
            {% if app.user %}
                <a href="#" class="btn btn-secondary">Signaler commentaire</a>
            {% endif %}
        </div>
    </section>

    {% endfor %}

{% endblock %}